<!DOCTYPE html>
<html lang="en">

<head>
    <!--meta tag start-->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="edustar">
    <meta name="author" content="khanalprem">
    <meta name="copyright" content="khanalprem">

    <!--title-->
    <title>账号注册</title>
    <!-- faveicon start   -->
    <link rel="icon" href="../images/favicon.png" type="image/x-icon">

    <!-- stylesheet start -->
    <link rel="stylesheet" type="text/css" href="../css/style.css">
    <link rel="stylesheet" type="text/css" href="../css/bubbletg.css">

</head>

<body>
<div id="header"></div>
<section class="breadcrumb" style="background-image: url(../images/background/breadcrumb.jpg);">
    <div class="breadcrumb-overlay"></div>
    <div class="container">
        <h1><a href="login.html">注册</a></h1>
        <span><a href="index.html">首页</a></span><span><i class="fa fa-angle-right"></i>注册</span>
    </div>
</section>

<section class="contact-page inner-page">
    <!--在中间-->
    <div class="container">
        <div class="row">
            <!--手机 平板 电脑-->
            <div class="col-xs-12 col-sm-6 col-md-4 container">
                <form id="registerForm" action="user" method="post" accept-charset="utf-8">
                    <input type="hidden" name="action" value="user"/>
                    <input type="hidden" name="id" value="0">
                    <input id="userName" name="userName" type="text" placeholder="请输入账号" autocomplete="off">
                    <span id="userNameSpan"></span>
                    <input id="userEmail" name="userEmail" type="email" placeholder="请输入邮箱" autocomplete="off">
                    <span id="userEmailSpan"></span>
                    <input id="userTelephone" name="userTelephone" type="text" placeholder="请输入手机号码" autocomplete="off">
                    <span id="userTelephoneSpan"></span>
                    <input id="userPassword" name="userPassword" type="password" placeholder="请输入密码" autocomplete="off">
                    <span id="userPasswordSpan"></span>
                    <input id="userAffirmPassword" name="userAffirmPassword" type="password" placeholder="确认密码"
                           autocomplete="off">
                    <span id="userAffirmPasswordSpan"></span>
                    <input id="userCreateDate" type="hidden" name="userCreateDate" value="">
                    <div class="verify">
                        <input name="check" type="text" placeholder="请输入验证码" autocomplete="off">
                        <div class="row">
                            <div class="col-xs-6 col-sm-6 col-md-6">
                                <span><img style="width: 100%" src="../checkCode" alt=""
                                           onclick="changeCheckCode(this)"></span>
                                <script type="text/javascript">
                                    //图片点击事件
                                    function changeCheckCode(img) {
                                        img.src = "../checkCode?" + new Date().getTime();
                                    }
                                </script>
                            </div>
                            <div class="col-xs-6 col-sm-6 col-md-6">
                                <div class="submit_btn">
                                    <button type="submit" id="btu_sub">注册</button>
                                </div>
                            </div>
                        </div>

                    </div>

                </form>

            </div>
        </div>

    </div>
</section>

<!--Footer Bottom-->
<div id="footer"></div>

<!-- scroll top -->
<a class="scroll-top fa fa-angle-up" href="javascript:void(0)"></a>
<!-- srolltop end -->

<script src=../js/jquery-3.2.1.min.js></script>
<script src=../js/bootstrap.min.js></script>
<script src=../js/jquery.mixitup.min.js></script>
<script src=../js/jquery.fancybox.min.js></script>
<script src=../js/jquery.counterup.min.js></script>
<script src=../js/waypoints.min.js></script>
<script src=../js/jquery.magnific-popup.min.js></script>
<script src=../js/owl.carousel.min.js></script>
<!-- <script src=js/countdown.js></script> -->
<script src=../js/script.js></script>
<!--导入布局js，共享header和footer-->
<script type="text/javascript" src="../js/include.js"></script>
</body>
<script>
    //校验用户名
    function checkUserName() {
        //1.获取用户名
        let username = $("#userName").val();
        //2.定义正则,4到16位（字母，数字，下划线，减号）
        let reg_username = /^[a-zA-Z0-9_-]{4,16}$/;
        //3.判断
        let flag = reg_username.test(username);
        if (flag) {
            //用户名合法
            //用户名非法,合法直接返回
            $("#userName").css("border", "");
            $("#userNameSpan").html("");
        } else {
            //用户名非法,加一个红色的边框
            $("#userName").css("border", "1px solid red");
            $("#userNameSpan").html("4到16位（字母，数字，下划线，减号）");
        }
        return flag;
    }

    //校验密码
    function checkPassword() {
        //1.获取密码
        let password = $("#userPassword").val();
        //2.定义正则,只能输入6-20个字母、数字、下划线
        let reg_password = /^(\w){6,20}$/;
        //3.判断
        let flag = reg_password.test(password);
        if (flag) {
            //密码合法
            //密码非法,合法直接返回
            $("#userPassword").css("border", "");
            $("#userPasswordSpan").html("");
        } else {
            //密码非法,加一个红色的边框
            $("#userPassword").css("border", "1px solid red");
            $("#userPasswordSpan").html("密码只能输入6-20个字母、数字、下划线");
        }
        return flag;
    }

    //校验确认密码
    function checkAffirmPassword() {
        //1.获得确认密码
        let affirmPassword = $("#userAffirmPassword").val();
        //2.获取密码
        let reg_password = $("#userPassword").val();
        //3.判断
        let flag = reg_password == affirmPassword;
        if (flag) {
            //密码合法
            //密码非法,合法直接返回
            $("#userAffirmPassword").css("border", "");
            $("#userAffirmPasswordSpan").html("");
        } else {
            //密码非法,加一个红色的边框
            $("#userAffirmPassword").css("border", "1px solid red");
            $("#userAffirmPasswordSpan").html("密码不一致");
        }
        return flag;
    }

    //校验邮箱
    function checkEmail() {
        let email = $("#userEmail").val();
        let reg_email = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
        let flag = reg_email.test(email);
        if (flag) {
            $("#userEmail").css("border", "");
            $("#userEmailSpan").html("");
        } else {
            $("#userEmail").css("border", "1px solid red");
            $("#userEmailSpan").html("邮箱格式不正确");
        }
        return flag;
    }

    //校验手机号码
    function checkTelephone() {
        let telephone = $("#userTelephone").val();
        let reg_telephone = /^1[3456789]\d{9}$/;
        let flag = reg_telephone.test(telephone);
        if (flag) {
            $("#userTelephone").css("border", "");
            $("#userTelephoneSpan").html("");
        } else {
            $("#userTelephone").css("border", "1px solid red");
            $("#userTelephoneSpan").html("手机号码格式不正确");
        }
        return flag;
    }

    $(function () {
        //当表单提交时，调用所有的校验方法
        $("#registerForm").submit(function () {
            //返回值为空，或者为true，则提交表单，如果返回false,则表单不提交
            if (checkUserName() && checkEmail() && checkTelephone()
                && checkPassword() && checkAffirmPassword()) {
                //设置用户注册时间
                $("#userCreateDate").val(new Date());
                //校验成功，提交表单
                // $("#registerForm") ,也可以写成$(this).serialize();
                // $(this).serialize()也可以写成$("#registerForm");
                $.post("../user/register", $("#registerForm").serialize(), function (data) {

                    //服务器响应数据
                    if (data.flag) {
                        //注册成功，跳转成功页面
                        location.href = "index.html";
                    } else {
                        //注册失败，给errorMsg 添加提示信息
                        $("#errorMsg").html(data.errorMsg);
                    }


                });
            }
            return false;
        });

        //当某一个组件失去焦点时，调用对应的校验方法
        $("#userName").blur(checkUserName);
        $("#userPassword").blur(checkPassword);
        $("#userAffirmPassword").blur(checkAffirmPassword);
        $("#userEmail").blur(checkEmail);
        $("#userTelephone").blur(checkTelephone);
    });
</script>

</html>

